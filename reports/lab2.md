## 实现的功能

1. 实现了系统调用 `sys_mmap`
步骤如下：
- `sys_mmap` 函数里调用 `task::mmap`。
- `task::mmap` 里对当前任务的 `MemorySet` 使用现有函数`insert_framed_area`，完成映射。

2. 实现了系统调用 `sys_munmap`
步骤如下：
- `sys_munmap` 函数里调用 `task::munmap`。
- `task::munmap` 里对当前任务的 `MemorySet` 使用新建的函数`remove_framed_area`。
- `remove_framed_area` 找到对应的`MapArea`, 并调用 `MapArea::unmap`。

## 完成问答题
### 请列举 SV39 页表页表项的组成，描述其中的标志位有何作用？

SV39 分页模式下的页表项，最低的 8 位 [7:0] 是标志位，它们的含义如下：

- 仅当 V(Valid) 位为 1 时，页表项才是合法的；
- R/W/X 分别控制索引到这个页表项的对应虚拟页面是否允许读/写/取指；
- U 控制索引到这个页表项的对应虚拟页面是否在 CPU 处于 U 特权级的情况下是否被允许访问；
- G 如果此位为1，则即使TLB（Translation Lookaside Buffer）刷新，该PTE也不会从TLB中移除。
- A(Accessed) 记录自从页表项上的这一位被清零之后，页表项的对应虚拟页面是否被访问过；
- D(Dirty) 则记录自从页表项上的这一位被清零之后，页表项的对应虚拟页表是否被修改过。

### 请问哪些异常可能是缺页导致的？

1. Load Page Fault (加载页面故障)：当CPU尝试从一个无效或未映射的虚拟地址加载数据时发生。这通常是由于请求的数据不在物理内存中，需要从磁盘上的交换空间或文件系统加载到内存中。
2. Store Page Fault (存储页面故障)：当CPU尝试向一个无效或未映射的虚拟地址写入数据时发生。这种情况同样是因为目标地址没有对应的物理页面，或者该页面当前不在物理内存中。
3. Instruction Page Fault (指令页面故障)：当CPU尝试从一个无效或未映射的虚拟地址取指令执行时发生。这意味着程序试图执行的代码段没有被加载到内存中，或者是权限设置不允许执行。

### 发生缺页时，描述相关重要寄存器的值，上次实验描述过的可以简略。

scause 寄存器： 这个寄存器存储了导致异常的原因。对于缺页异常，scause 会包含特定的代码来标识是加载页面故障、存储页面故障还是指令页面故障。

stval 寄存器： stval 寄存器在发生异常时通常会保存与异常相关的地址信息。对于缺页异常，mtval 会保存引发缺页的虚拟地址。

sepc 寄存器： sepc 寄存器保存了异常发生时的程序计数器（PC）的值，即发生异常的指令的地址。

sstatus 寄存器： sstatus 寄存器包含了S模式下的状态信息，如 SPP 表示异常发生前的特权模式。

### 这样做有哪些好处？

可以做到

按需加载：操作系统可以按需加载页面，这减少了内存的浪费。

内存复用：多个进程可以共享相同的只读页面（如程序代码），从而节省内存。

### 处理 10G 连续的内存页面，对应的 SV39 页表大致占用多少内存 (估算数量级即可)？

只计算三级叶子节点的情况下，
10 * 1024 * 1024 * 1024 / 4096 / 512 = 5120 个页面用来保持页表项
5120 * 4096 = 20,971,520字节，20MB

### 请简单思考如何才能实现 Lazy 策略，缺页时又如何处理？描述合理即可，不需要考虑实现。

在程序启动时，操作系统创建虚拟地址空间，但不立即分配物理内存。只是建立虚拟地址到物理地址的映射关系，但这些映射指向的是未分配的物理页面。可以将所有页面的页表项Flag里的V设置为无效。

操作系统监控对虚拟地址的访问。当程序尝试访问一个尚未加载的页面时，会产生缺页异常。

当发生缺页异常时，操作系统验证虚拟地址的合法性和访问权限，从磁盘加载所需页面到物理内存，更新页表，并恢复程序执行。

### 此时页面失效如何表现在页表项(PTE)上？
可以使用PTE的V位来表示。当PTE的V为0时，表示该页表项无效。还可以利用保留位特殊标记这是一个被换出的页面。

### 在单页表情况下，如何更换页表？
系统调用时不需要切换页表，切换任务时更换页表。

### 单页表情况下，如何控制用户态无法访问内核页面？（tips:看看上一题最后一问）
在单页表情况下，用户态无法访问内核页，因为内核页的PTE的U位为0，而用户态的PTE的U位为1。

### 单页表有何优势？（回答合理即可）
优势在于系统调用时不需要更换页表，能有效利用TLB。

### 双页表实现下，何时需要更换页表？
系统调用时更换页表。

### 假设你写一个单页表操作系统，你会选择何时更换页表（回答合理即可）？
切换任务时更换页表。

## 荣誉准则
1. 在完成本次实验的过程（含此前学习的过程）中，我曾分别与 以下各位 就（与本次实验相关的）以下方面做过交流，还在代码中对应的位置以注释形式记录了具体的交流对象及内容：

没有交流的对象。

此外，我也参考了 以下资料 ，还在代码中对应的位置以注释形式记录了具体的参考来源及内容：

没有参考的资料。

3. 我独立完成了本次实验除以上方面之外的所有工作，包括代码与文档。 我清楚地知道，从以上方面获得的信息在一定程度上降低了实验难度，可能会影响起评分。

4. 我从未使用过他人的代码，不管是原封不动地复制，还是经过了某些等价转换。 我未曾也不会向他人（含此后各届同学）复制或公开我的实验代码，我有义务妥善保管好它们。 我提交至本实验的评测系统的代码，均无意于破坏或妨碍任何计算机系统的正常运转。 我清楚地知道，以上情况均为本课程纪律所禁止，若违反，对应的实验成绩将按“-100”分计。